define(["@jupyter-widgets/base"],(e=>(()=>{"use strict";var n,t,o,i,r,s,a,u,c,l,d,_,b,p,f,g,m,v,h,w,x,y,j,k,O,S,E,V,A,T,W,q,F,M,P,L,D,N,z,C,J,R,U,I,B,X,Z,G,Q,$,H,K,Y={820:(e,n,t)=>{t.r(n),t.d(n,{MODULE_NAME:()=>r,MODULE_VERSION:()=>i,VegaFusionModel:()=>a,VegaFusionView:()=>u});const o=t(147),i=o.version,r=o.name;var s=t(146);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.model_name,_model_module:a.model_module,_model_module_version:a.model_module_version,_view_name:a.view_name,_view_module:a.view_module,_view_module_version:a.view_module_version,spec:null,full_vega_spec:null,client_vega_spec:null,server_vega_spec:null,vegafusion_handle:null,verbose:null,debounce_wait:30,debounce_max_wait:60,download_source_link:null,_request_msg:null,_response_msg:null})}}a.serializers=Object.assign(Object.assign({},s.DOMWidgetModel.serializers),{_request_msg:{serialize:e=>e.buffer?new DataView(e.buffer.slice(0)):null}}),a.model_name="VegaFusionModel",a.model_module=r,a.model_module_version=i,a.view_name="VegaFusionView",a.view_module=r,a.view_module_version=i;class u extends s.DOMWidgetView{async render(){const{embedVegaFusion:e}=await t.e(876).then(t.bind(t,876));this.embedVegaFusion=e;const{compile:n}=await t.e(647).then(t.bind(t,647));this.vegalite_compile=n,this.value_changed(),this.model.on("change:spec",this.value_changed,this),this.model.on("change:verbose",this.value_changed,this),this.model.on("change:debounce_wait",this.value_changed,this),this.model.on("change:debounce_max_wait",this.value_changed,this),this.model.on("change:download_source_link",this.value_changed,this),this.model.on("change:_response_msg",(()=>{const e=this.model.get("_response_msg");if(null!==e){this.model.get("verbose")&&(console.log("VegaFusion(js): Received response"),console.log(e.buffer));const n=new Uint8Array(e.buffer);this.vegafusion_handle.receive(n)}}))}value_changed(){let e=this.model.get("spec");if(null!==e){let n,t=JSON.parse(e);if(t.$schema.endsWith("schema/vega/v5.json"))n=e;else{let e=this.vegalite_compile(t);n=JSON.stringify(e.spec,null,2)}let o={verbose:this.model.get("verbose")||!1,debounce_wait:this.model.get("debounce_wait")||30,debounce_max_wait:this.model.get("debounce_max_wait"),download_source_link:this.model.get("download_source_link")};this.vegafusion_handle=this.embedVegaFusion(this.el,n,(e=>{this.model.get("verbose")&&console.log("VegaFusion(js): Send request"),this.model.set("_request_msg",new DataView(e.buffer)),this.touch(),this.model.set("_request_msg",{})}),o),this.model.set("full_vega_spec",n),this.model.set("client_vega_spec",this.vegafusion_handle.client_spec_json()),this.model.set("server_vega_spec",this.vegafusion_handle.server_spec_json()),this.model.set("comm_plan",this.vegafusion_handle.comm_plan_json()),this.touch()}}}window.__webpack_public_path__=document.querySelector("body").getAttribute("data-base-url")+"nbextensions/vegafusion-jupyter/"},146:n=>{n.exports=e},147:e=>{e.exports=JSON.parse('{"name":"vegafusion-jupyter","version":"0.8.0","description":"Altair Jupyter Widget library that relies on VegaFusion for serverside calculations","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","dist/*.wasm","css/*.css","css/*.scss","images/*.svg"],"homepage":"https://github.com/vegafusion/vegafusion","bugs":{"url":"https://github.com/vegafusion/vegafusion/issues"},"license":"AGPL-3.0-or-later","author":{"name":"VegaFusion Technologies LLC","email":"jon@vegafusion.io"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/jonmmease/vegafusion"},"scripts":{"build:dev":"npm run build:lib && npm run build:nbextension && npm run build:labextension:dev && pip install --force-reinstall --no-deps -e .","build:prod":"npm run clean && npm run build:lib && npm run build:nbextension && npm run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc && sass scss:css","build:nbextension":"webpack","clean":"npm run clean:lib && npm run clean:dist && npm run clean:nbextension && npm run clean:labextension","clean:dist":"rimraf dist","clean:lib":"rimraf lib","clean:labextension":"rimraf vegafusion_jupyter/labextension","clean:nbextension":"rimraf vegafusion_jupyter/nbextension/* && cp src/nbextension/extension.js vegafusion_jupyter/nbextension/","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"npm run build:prod","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","@jupyterlab/notebook":"^3.0.0 || ^4.0.0","marked":"^4.0.10","vega-lite":"^4.17.0","vegafusion-embed":"../../javascript/vegafusion-embed"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"6.5.1","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","sass":"^1.45.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","svg-inline-loader":"^0.8.2","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.65.0","webpack-cli":"^4.9.1","webpack-require-from":"^1.8.6"},"jupyterlab":{"extension":"lib/plugin","outputDir":"vegafusion_jupyter/labextension/","webpackConfig":"webpack.config.experimental.js","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}},ee={};function ne(e){var n=ee[e];if(void 0!==n)return n.exports;var t=ee[e]={id:e,loaded:!1,exports:{}};return Y[e].call(t.exports,t,t.exports,ne),t.loaded=!0,t.exports}return ne.m=Y,ne.c=ee,n="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i=e=>!--e.r&&e(),r=(e,n)=>e?e.push(n):i(n),ne.a=(e,s,a)=>{var u,c,l,d=a&&[],_=e.exports,b=!0,p=!1,f=(e,t,o)=>{p||(p=!0,t.r+=e.length,e.map(((e,i)=>e[n](t,o))),p=!1)},g=new Promise(((e,n)=>{l=n,c=()=>(e(_),o(d),d=0)}));g[t]=_,g[n]=(e,n)=>{if(b)return i(e);u&&f(u,e,n),r(d,e),g.catch(n)},e.exports=g,s((e=>{if(!e)return c();var s,a;u=(e=>e.map((e=>{if(null!==e&&"object"==typeof e){if(e[n])return e;if(e.then){var s=[];e.then((e=>{a[t]=e,o(s),s=0}));var a={};return a[n]=(n,t)=>(r(s,n),e.catch(t)),a}}var u={};return u[n]=e=>i(e),u[t]=e,u})))(e);var l=new Promise(((e,n)=>{(s=()=>e(a=u.map((e=>e[t])))).r=0,f(u,s,n)}));return s.r?l:a})).then(c,l),b=!1},ne.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return ne.d(n,{a:n}),n},ne.d=(e,n)=>{for(var t in n)ne.o(n,t)&&!ne.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},ne.f={},ne.e=e=>Promise.all(Object.keys(ne.f).reduce(((n,t)=>(ne.f[t](e,n),n)),[])),ne.u=e=>e+".index.js",ne.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),ne.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),ne.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s={},a="vegafusion-jupyter:",ne.l=(e,n,t,o)=>{if(s[e])s[e].push(n);else{var i,r;if(void 0!==t)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var l=u[c];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==a+t){i=l;break}}i||(r=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,ne.nc&&i.setAttribute("nonce",ne.nc),i.setAttribute("data-webpack",a+t),i.src=e),s[e]=[n];var d=(n,t)=>{i.onerror=i.onload=null,clearTimeout(_);var o=s[e];if(delete s[e],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(t))),n)return n(t)},_=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),r&&document.head.appendChild(i)}},ne.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},ne.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),ne.p="",Object.defineProperty(ne,"p",{get:function(){try{if("string"!=typeof __webpack_public_path__)throw new Error("WebpackRequireFrom: '__webpack_public_path__' is not a string or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return __webpack_public_path__}catch(e){return console.error(e),""}},set:function(e){console.warn("WebpackRequireFrom: something is trying to override webpack public path. Ignoring the new value"+e+".")}}),(()=>{var e={179:0};ne.f.j=(n,t)=>{var o=ne.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var i=new Promise(((t,i)=>o=e[n]=[t,i]));t.push(o[2]=i);var r=ne.p+ne.u(n),s=new Error;ne.l(r,(t=>{if(ne.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+i+": "+r+")",s.name="ChunkLoadError",s.type=i,s.request=r,o[1](s)}}),"chunk-"+n,n)}};var n=(n,t)=>{var o,i,[r,s,a]=t,u=0;if(r.some((n=>0!==e[n]))){for(o in s)ne.o(s,o)&&(ne.m[o]=s[o]);a&&a(ne)}for(n&&n(t);u<r.length;u++)i=r[u],ne.o(e,i)&&e[i]&&e[i][0](),e[i]=0},t=self.webpackChunkvegafusion_jupyter=self.webpackChunkvegafusion_jupyter||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),$={},H={724:function(){return{"./vegafusion_wasm_bg.js":{__wbindgen_object_drop_ref:function(e){return void 0===u&&(u=ne.c[264].exports),u.ug(e)},__wbg_log_bf0aaa8489896f12:function(e,n){return void 0===c&&(c=ne.c[264].exports),c.Aw(e,n)},__wbg_setSignalValue_06d39b30b727ddc4:function(e,n,t,o,i,r){return void 0===l&&(l=ne.c[264].exports),l.tl(e,n,t,o,i,r)},__wbg_setDataValue_7b26f6a9ae944a57:function(e,n,t,o,i,r){return void 0===d&&(d=ne.c[264].exports),d.Gy(e,n,t,o,i,r)},__wbg_run_9c538ec2dcc2d17a:function(e){return void 0===_&&(_=ne.c[264].exports),_.eQ(e)},__wbindgen_json_serialize:function(e,n){return void 0===b&&(b=ne.c[264].exports),b.r1(e,n)},__wbg_msgreceiver_new:function(e){return void 0===p&&(p=ne.c[264].exports),p.rx(e)},__wbg_toImageURL_f07799099ad25554:function(e,n,t,o){return void 0===f&&(f=ne.c[264].exports),f.Q3(e,n,t,o)},__wbg_localTimezone_448acae87cdcb404:function(e){return void 0===g&&(g=ne.c[264].exports),g.Z6(e)},__wbg_parse_1285c9e638e22abc:function(e){return void 0===m&&(m=ne.c[264].exports),m.yT(e)},__wbg_new_2c2aca3a7dc4d5c2:function(e){return void 0===v&&(v=ne.c[264].exports),v.Xq(e)},__wbg_initialize_429cb4bfe0aaea97:function(e,n){return void 0===h&&(h=ne.c[264].exports),h.Z9(e,n)},__wbg_hover_b90b17a03893d8e6:function(e){return void 0===w&&(w=ne.c[264].exports),w.Lv(e)},__wbg_setupTooltip_dec83eb8be01c071:function(e){return void 0===x&&(x=ne.c[264].exports),x.ER(e)},__wbindgen_object_clone_ref:function(e){return void 0===y&&(y=ne.c[264].exports),y.m_(e)},__wbg_addSignalListener_7958d7eb12fbdda5:function(e,n,t,o,i,r,s,a,u){return void 0===j&&(j=ne.c[264].exports),j.oE(e,n,t,o,i,r,s,a,u)},__wbg_addDataListener_153f431990da37d7:function(e,n,t,o,i,r,s,a,u){return void 0===k&&(k=ne.c[264].exports),k.qv(e,n,t,o,i,r,s,a,u)},__wbg_vegaversion_caa329bb52b89160:function(e){return void 0===O&&(O=ne.c[264].exports),O.y1(e)},__wbg_makegrpcsendmessagefn_bb7280148f8ce04c:function(e,n,t){return void 0===S&&(S=ne.c[264].exports),S.aF(e,n,t)},__wbindgen_json_parse:function(e,n){return void 0===E&&(E=ne.c[264].exports),E.t$(e,n)},__wbg_new_693216e109162396:function(){return void 0===V&&(V=ne.c[264].exports),V.Ih()},__wbg_stack_0ddaca5d1abfb52f:function(e,n){return void 0===A&&(A=ne.c[264].exports),A.yq(e,n)},__wbg_error_09919627ac0992f5:function(e,n){return void 0===T&&(T=ne.c[264].exports),T.gk(e,n)},__wbg_instanceof_Window_c4b70662a0d2c5ec:function(e){return void 0===W&&(W=ne.c[264].exports),W.Um(e)},__wbg_document_1c64944725c0d81d:function(e){return void 0===q&&(q=ne.c[264].exports),q.WS(e)},__wbg_newnoargs_be86524d73f67598:function(e,n){return void 0===F&&(F=ne.c[264].exports),F.wg(e,n)},__wbg_call_888d259a5fefc347:function(e,n){return void 0===M&&(M=ne.c[264].exports),M.BT(e,n)},__wbg_self_c6fbdfc2918d5e58:function(){return void 0===P&&(P=ne.c[264].exports),P.JX()},__wbg_window_baec038b5ab35c54:function(){return void 0===L&&(L=ne.c[264].exports),L.xd()},__wbg_globalThis_3f735a5746d41fbd:function(){return void 0===D&&(D=ne.c[264].exports),D.ud()},__wbg_global_1bc0b39582740e95:function(){return void 0===N&&(N=ne.c[264].exports),N.PT()},__wbindgen_is_undefined:function(e){return void 0===z&&(z=ne.c[264].exports),z.XP(e)},__wbg_call_8a893cac80deeb51:function(e,n,t,o){return void 0===C&&(C=ne.c[264].exports),C.bO(e,n,t,o)},__wbg_getTimezoneOffset_d3e5a22a1b7fb1d8:function(e){return void 0===J&&(J=ne.c[264].exports),J.LJ(e)},__wbg_new0_fd3a3a290b25cdac:function(){return void 0===R&&(R=ne.c[264].exports),R.qs()},__wbg_buffer_397eaa4d72ee94dd:function(e){return void 0===U&&(U=ne.c[264].exports),U.jp(e)},__wbg_newwithbyteoffsetandlength_4b9b8c4e3f5adbff:function(e,n,t){return void 0===I&&(I=ne.c[264].exports),I.WK(e,n,t)},__wbg_new_a7ce447f15ff496f:function(e){return void 0===B&&(B=ne.c[264].exports),B.y4(e)},__wbindgen_debug_string:function(e,n){return void 0===X&&(X=ne.c[264].exports),X.fY(e,n)},__wbindgen_throw:function(e,n){return void 0===Z&&(Z=ne.c[264].exports),Z.Or(e,n)},__wbindgen_memory:function(){return void 0===G&&(G=ne.c[264].exports),G.oH()},__wbindgen_closure_wrapper1250:function(e,n,t){return void 0===Q&&(Q=ne.c[264].exports),Q.Z7(e,n,t)}}}}},K={594:[724]},ne.w={},ne.f.wasm=function(e,n){(K[e]||[]).forEach((function(t,o){var i=$[t];if(i)n.push(i);else{var r,s=H[t](),a=fetch(ne.p+""+{594:{724:"9598f733518b59527718"}}[e][t]+".module.wasm");r=s&&"function"==typeof s.then&&"function"==typeof WebAssembly.compileStreaming?Promise.all([WebAssembly.compileStreaming(a),s]).then((function(e){return WebAssembly.instantiate(e[0],e[1])})):"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,s):a.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,s)})),n.push($[t]=r.then((function(e){return ne.w[t]=(e.instance||e).exports})))}}))},ne(820)})()));