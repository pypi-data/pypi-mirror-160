"use strict";(self.webpackChunkjupyterlab_s3_browser=self.webpackChunkjupyterlab_s3_browser||[]).push([[273],{273:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var r=n(828),a=n(138),o=n(372),s=n(299),i=n(840),c=n(309),l=n(22),h=n(485);async function d(e,t){const n=h.ServerConnection.makeSettings();return await(await h.ServerConnection.makeRequest(c.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/files",e),{method:"PUT",body:JSON.stringify({content:t})},n)).json()}async function u(e){const t=h.ServerConnection.makeSettings(),n=await(await h.ServerConnection.makeRequest(c.URLExt.join(t.baseUrl,"jupyterlab_s3_browser/files",e),{method:"GET",headers:{"X-Custom-S3-Is-Dir":"true"}},t)).json();return{type:"directory",path:e.trim(),name:"",format:"json",content:n.map((e=>function(e){return{name:e.name,path:e.path,format:"json",type:e.type,created:"",writable:!0,last_modified:"",mimetype:e.mimetype,content:e.content}}(e))),created:"",writable:!0,last_modified:"",mimetype:""}}var m,p=n(318);class y{constructor(e){this._isDisposed=!1,this._fileChanged=new i.Signal(this),this._registry=e}get name(){return"S3"}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,i.Signal.clearData(this))}async get(e,t){if("file"===t.type||"notebook"===t.type){const t=await async function(e){const t=h.ServerConnection.makeSettings();return(await h.ServerConnection.makeRequest(c.URLExt.join(t.baseUrl,"jupyterlab_s3_browser/files",e),{method:"GET"},t)).json()}(e),n=this._registry.getFileTypesForPath(e),r=0===n.length?this._registry.getFileType("text"):n[0],a=r.mimeTypes[0],o=r.fileFormat;let s;switch(o){case"text":s=m.b64DecodeUTF8(t.content);break;case"base64":s=t.content;break;case"json":s=JSON.parse(m.b64DecodeUTF8(t.content));break;default:throw new Error(`Unexpected file format: ${r.fileFormat}`)}return{type:"file",path:e,name:"",format:o,content:s,created:"",writable:!0,last_modified:"",mimetype:a}}return await u(e)}async getDownloadUrl(e){throw await(0,p.showDialog)({title:"Sorry",body:"This feature is not yet implemented.",buttons:[p.Dialog.cancelButton({label:"Cancel"})]}),Error("Not yet implemented")}async newUntitled(e={}){let t;const n="untitled";let r=n;const a=(await u(e.path)).content.map((e=>e.name));let o=0;for(;a.includes(r);)o++,r=n+o;switch(e.type){case"file":t=await d(e.path+"/"+r,"");break;case"directory":if(""===e.path)throw new Error("Bucket creation is not currently supported.");t=await async function(e){const t=h.ServerConnection.makeSettings();return await(await h.ServerConnection.makeRequest(c.URLExt.join(t.baseUrl,"jupyterlab_s3_browser/files",e),{method:"PUT",headers:{"X-Custom-S3-Is-Dir":"true"}},t)).json(),{type:"directory",path:e.trim(),name:"Untitled",format:"json",content:[],created:"",writable:!0,last_modified:"",mimetype:""}}(e.path+"/"+r);break;default:throw new Error(`Unexpected type: ${e.type}`)}const s=this._registry.getFileTypesForPath(t.path),i=0===s.length?this._registry.getFileType("text"):s[0],l=i.mimeTypes[0],m=i.fileFormat,p={type:e.type,path:e.path,name:r,format:m,content:"",created:"",writable:!0,last_modified:"",mimetype:l};return this._fileChanged.emit({type:"new",oldValue:null,newValue:p}),p}async delete(e){const t=await async function(e){const t=h.ServerConnection.makeSettings();return await(await h.ServerConnection.makeRequest(c.URLExt.join(t.baseUrl,"jupyterlab_s3_browser/files",e),{method:"DELETE"},t)).json()}(e);if(t.error&&"DIR_NOT_EMPTY"===t.error)throw new Error(`${e} is not empty. Deletion of non-empty directories is not currently supported.`);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){if(!e.includes("/"))throw Error("Renaming of buckets is not currently supported.");const n=await async function(e,t){const n=h.ServerConnection.makeSettings();return await(await h.ServerConnection.makeRequest(c.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/files",t),{method:"PUT",headers:{"X-Custom-S3-Move-Src":e}},n)).json()}(e,t);return this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:n}),n}async save(e,t){let n=t.content;"base64"===t.format?n=m.b64DecodeUTF8(t.content):"json"===t.format&&(n=JSON.stringify(t.content));const r=await d(e,n),a=this._registry.getFileTypesForPath(r.path),o=0===a.length?this._registry.getFileType("text"):a[0],s=o.mimeTypes[0],i=o.fileFormat,c={type:t.type,path:t.path,name:t.name,format:i,content:n,created:"",writable:!0,last_modified:"",mimetype:s};return this._fileChanged.emit({type:"save",oldValue:null,newValue:c}),c}async copy(e,t){let n=c.PathExt.basename(e).split(".")[0];n+="-copy";const r="/"+t+"/"+n+c.PathExt.extname(e),a=await async function(e,t){const n=h.ServerConnection.makeSettings();return await(await h.ServerConnection.makeRequest(c.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/files",t),{method:"PUT",headers:{"X-Custom-S3-Copy-Src":e}},n)).json()}(e,r);return this._fileChanged.emit({type:"new",oldValue:null,newValue:a}),a}async createCheckpoint(e){}async listCheckpoints(e){return[]}async restoreCheckpoint(e,t){throw Error("Not yet implemented")}async deleteCheckpoint(e,t){}}!function(e){const t=new TextDecoder("utf8");e.b64DecodeUTF8=function(e){const n=l.toByteArray(e.replace(/\n/g,""));return t.decode(n)}}(m||(m={}));var w=n(992),b=n(227);let f;class g extends w.Widget{constructor(e,t,n){super(),this.addClass("jp-S3Browser"),this.layout=new w.PanelLayout;const r=()=>{const t=document.querySelector("#s3form"),n=new FormData(t),r={};n.forEach(((e,t)=>{r[t]=e}));const a=h.ServerConnection.makeSettings();h.ServerConnection.makeRequest(c.URLExt.join(a.baseUrl,"jupyterlab_s3_browser/auth"),{method:"POST",body:JSON.stringify(r)},a).then((t=>{t.json().then((t=>{if(t.success)this.layout.removeWidget(f),this.layout.addWidget(e),e.model.refresh();else{let e=t.message;e.includes("InvalidAccessKeyId")?e="The access key ID you entered was invalid.":e.includes("SignatureDoesNotMatch")&&(e="The secret access key you entered was invalid"),(0,p.showErrorMessage)("S3 Authentication Error",Error(e))}}))}))};S.checkIfAuthenicated().then((t=>{t?(this.layout.addWidget(e),setTimeout((()=>{e.model.refresh()}),1e3)):(f=new w.Widget({node:S.createS3AuthenticationForm(r)}),this.layout.addWidget(f))}))}}var S;!function(e){e.createS3AuthenticationForm=function(e){return b.VirtualDOM.realize(b.h.div({className:"s3form"},b.h.h4("S3 Object Storage Browser"),b.h.div("This extension allows you to browse S3-compatible object storage instances, such as AWS S3 and IBM Cloud Object Storage."),b.h.br(),b.h.form({id:"s3form",method:"post"},b.h.p(b.h.label({},"Endpoint URL"),b.h.br(),b.h.input({type:"url",name:"endpoint_url"})),b.h.br(),b.h.p(b.h.label({},"Access Key ID"),b.h.br(),b.h.input({type:"text",name:"client_id"})),b.h.br(),b.h.p(b.h.label({},"Secret Access Key"),b.h.br(),b.h.input({type:"password",name:"client_secret"})),b.h.br(),b.h.p(b.h.label({},"(Optional) Session Token"),b.h.br(),b.h.input({type:"password",name:"session_token"}))),b.h.br(),b.h.p({className:"s3-connect"},b.h.button({onclick:e,className:"jp-mod-accept jp-mod-styled"},"Connect"))))},e.checkIfAuthenicated=function(){return new Promise(((e,t)=>{const n=h.ServerConnection.makeSettings();h.ServerConnection.makeRequest(c.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/auth"),{method:"GET"},n).then((t=>{t.json().then((t=>{e(t.authenticated)}))}))}))}}(S||(S={}));const _="s3-filebrowser",j={id:"jupyterlab_s3_browser:drive",requires:[o.IDocumentManager,s.IFileBrowserFactory,r.ILayoutRestorer,a.ISettingRegistry],activate:function(e,t,n,r,a){const o=new y(e.docRegistry);t.services.contents.addDrive(o);const s=n.createFileBrowser(_,{driveName:o.name,state:null,refreshInterval:3e5}),i=new g(s,o,t);return i.title.iconClass="jp-S3-icon jp-SideBar-tabIcon",i.title.caption="Object Storage Browser",i.id="s3-file-browser",r.add(i,_),void e.shell.add(i,"left",{rank:501})},autoStart:!0}}}]);